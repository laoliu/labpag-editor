# 🎯 PAG 编辑器快速参考

## 🚀 三种导出方式

### 1️⃣ 服务端导出 PAG

**位置：** 顶部提示区域  
**按钮：** 💾 服务端导出 PAG

**使用：**
```
1. 上传 PAG 模板
2. 编辑文本/图片
3. 点击"服务端导出 PAG"
4. 下载修改后的 PAG
```

**特点：**
- ✅ 直接生成 PAG 文件
- ✅ 使用当前编辑的内容
- ✅ 无需 JSON 配置
- ⚠️ 需要服务器运行

---

### 2️⃣ 导出 JSON 配置

**位置：** 预览区域下方  
**按钮：** 📋 导出修改配置 (JSON)

**使用：**
```
1. 上传 PAG 模板
2. 编辑文本/图片
3. 点击"导出修改配置"
4. 保存 JSON 文件
5. 后续使用批量工具生成
```

**特点：**
- ✅ 保存配置供后续使用
- ✅ 可批量处理
- ✅ 无需服务器
- ❌ 不直接生成 PAG

**JSON 格式：**
```json
{
  "modifications": [
    {
      "layerIndex": 0,
      "type": "text",
      "value": "新文本"
    },
    {
      "layerIndex": 1,
      "type": "image",
      "imageData": "data:image/jpeg;base64,..."
    }
  ]
}
```

---

### 3️⃣ 应用配置并导出 PAG ⭐

**位置：** 页面底部 "高级：JSON 批量配置" 区域  
**按钮：** ⚡ 应用配置并导出 PAG

**使用 A - 使用当前修改：**
```
1. 上传 PAG 模板
2. 编辑文本/图片
3. 滚动到底部
4. 点击"⚡ 应用配置并导出 PAG"
5. 下载新 PAG 文件
```

**使用 B - 导入 JSON 配置：**
```
1. 上传 PAG 模板
2. 在 JSON 文本框中粘贴配置
3. 点击"⚡ 应用配置并导出 PAG"
4. 下载新 PAG 文件
```

**特点：**
- ✅ 支持当前修改
- ✅ 支持导入 JSON
- ✅ 一键完成
- ✅ 灵活性强
- ⚠️ 需要服务器运行

---

## 📊 方式对比

| 方式 | 服务端导出 | JSON 配置 | 应用并导出⭐ |
|------|-----------|----------|------------|
| 需要服务器 | ✅ | ❌ | ✅ |
| 直接生成 PAG | ✅ | ❌ | ✅ |
| 可批量处理 | ❌ | ✅ | ✅ |
| 支持 JSON 导入 | ❌ | ❌ | ✅ |
| 使用难度 | ⭐⭐ | ⭐⭐⭐ | ⭐ |

---

## 🎯 快速决策

### 我想快速修改一个 PAG 文件

**推荐：** 应用配置并导出 PAG ⚡

```
上传 → 编辑 → 点击"应用配置并导出" → 完成！
```

---

### 我想保存配置供后续使用

**推荐：** 导出 JSON 配置 📋

```
上传 → 编辑 → 导出 JSON → 保存文件
后续使用: apply_json_to_pag.py
```

---

### 我想测试多个版本

**推荐：** 应用配置并导出 PAG ⚡

```
准备多个 JSON 配置
逐个粘贴 → 点击"应用配置并导出" → 获得多个 PAG
```

---

### 我想批量生成 100 个 PAG 文件

**推荐：** 导出 JSON 配置 + Python 批量工具

```
1. Web 编辑器设计样本 → 导出 JSON
2. 准备 CSV 数据
3. Python 脚本批量生成
```

---

## 🔧 服务器启动方式

### 完整测试环境
```bash
test_pag_editor_full.bat
# 或
test_json_export.bat
```

### 仅启动导出服务器
```bash
start_pag_export_server.bat
# 或
python pag_export_server.py
```

### 手动启动全部
```bash
# 终端 1: 导出服务器
python pag_export_server.py

# 终端 2: Web 服务器
cd web
python -m http.server 8000
```

---

## 🌐 访问地址

| 服务 | 地址 |
|------|------|
| Web 编辑器 | http://localhost:8000/pag_template_editor.html |
| 导出服务器 | http://localhost:5000 |
| 主页导航 | http://localhost:8000/ |

---

## 💡 常用操作

### 编辑文本

```
1. 点击文本图层的"编辑"按钮
2. 在文本框中输入新内容
3. 点击"✅ 更新文本"
4. 查看预览效果
```

### 替换图片

```
1. 点击图片图层的"编辑"按钮
2. 选择新图片文件
3. 预览图片
4. 点击"✅ 更新图片"
5. 查看预览效果
```

### 播放/停止预览

```
播放: 点击 "▶️ 播放"
停止: 点击 "⏹️ 停止"
```

### 查看编辑历史

```
在"已编辑历史"区域查看所有修改
点击标题栏可折叠/展开
```

---

## ❓ 快速故障排除

### 问题：点击导出按钮没反应

**检查：** 服务器是否运行？

```bash
# 访问这个地址检查
http://localhost:5000

# 如果无法访问，启动服务器
start_pag_export_server.bat
```

---

### 问题：JSON 格式错误

**检查：** JSON 是否包含 `modifications` 数组？

```json
{
  "modifications": [...]  // ✅ 正确
}

// ❌ 错误：直接写数组
[...]
```

**解决：** 使用"导出当前配置"生成标准格式

---

### 问题：图片没有应用

**检查：** JSON 中是否有 `imageData` 字段？

```json
{
  "layerIndex": 1,
  "type": "image",
  "imageData": "data:image/jpeg;base64,..."  // ✅ 必须
}
```

**解决：** 在 Web 编辑器中上传图片会自动包含

---

### 问题：libpag 未安装

```bash
pip install libpag
```

如果安装失败，使用 JSON 导出方式，在其他环境处理

---

## 📚 相关文档

| 文档 | 内容 |
|------|------|
| JSON_TO_PAG_IN_BROWSER.md | 浏览器导出完整指南 |
| JSON_CONFIG_MASTER.md | JSON 配置总索引 |
| HOW_TO_USE_YOUR_JSON.md | 使用导出的 JSON |
| JSON_QUICK_START.md | 快速入门 |
| CHANGELOG_PAG_EDITOR.md | 更新日志 |

---

## 🎬 完整工作流

### 单文件编辑流程

```
1. 启动服务器
   └─ test_json_export.bat

2. 打开编辑器
   └─ http://localhost:8000/pag_template_editor.html

3. 上传 PAG 模板
   └─ 拖放或点击上传

4. 编辑内容
   ├─ 选择图层
   ├─ 修改文本/图片
   └─ 查看预览

5. 导出 PAG
   └─ 点击"⚡ 应用配置并导出 PAG"

6. 下载完成
   └─ 浏览器自动下载 modified_xxx.pag
```

---

### 批量生成流程

```
1. 设计样本
   ├─ Web 编辑器设计
   ├─ 导出 JSON 配置
   └─ 保存为 template_config.json

2. 准备数据
   ├─ 创建 data.csv
   └─ 包含所有变量（姓名、图片路径等）

3. 批量生成配置
   ├─ Python 脚本读取 CSV
   ├─ 基于样本生成多个 JSON
   └─ 保存到 configs/ 目录

4. 批量生成 PAG
   ├─ 使用 apply_json.bat
   ├─ 循环处理所有 JSON
   └─ 生成到 output/ 目录

5. 验证结果
   └─ 在播放器中预览
```

---

## ⌨️ 快捷键

| 操作 | 快捷键 |
|------|--------|
| 打开开发者工具 | F12 |
| 刷新页面 | F5 / Ctrl+R |
| 强制刷新 | Ctrl+F5 |

---

## 📝 注意事项

### ⚠️ 服务器必须运行

所有导出 PAG 功能都需要后端服务器！

**检查方式：**
```
访问 http://localhost:5000
应该看到服务器信息页面
```

---

### ⚠️ 图片格式支持

**支持：** PNG, JPG, JPEG, WebP

**推荐：** PNG（支持透明）

**大小：** 建议 < 5MB

---

### ⚠️ PAG 文件大小

**推荐：** < 50MB

**原因：** 浏览器内存限制

**超大文件：** 使用命令行工具

---

## 🎯 最佳实践

### ✅ 做什么

- 在编辑器中设计和测试
- 导出 JSON 保存配置
- 使用批量工具大规模生成
- 定期检查服务器状态

### ❌ 不要做什么

- 不要处理超大 PAG 文件（> 50MB）
- 不要在没有服务器时尝试导出 PAG
- 不要手动编写复杂 JSON（易出错）
- 不要忘记保存重要配置

---

**快速开始：** 运行 `test_json_export.bat`

**在线编辑：** http://localhost:8000/pag_template_editor.html

**最后更新：** 2025-11-29
